<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/6847ed686e.js" crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=account_circle" />
    <link rel="stylesheet" href="style.css">
    <title>virtual</title>
    <style>
        /* Simple styling for progress dialog and button */
        #pay {
            display: none;
        }

        .loading {
            display: none;
            width: 100px;
            height: 100px;
            border: 10px solid #f3f3f3;
            border-top: 10px solid #3498db;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Position the Toast in the center */
        .toast-message {
            background-color: #ff3b30;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            padding: 15px;
            border-radius: 8px;
        }

        /* Optional: Add a little style for the page (toast animation time, border radius, etc.) */
        .toastify {
            animation: toastAnimation 0.5s ease-in-out;
        }

        @keyframes toastAnimation {
            0% {
                opacity: 0;
            }

            100% {
                opacity: 1;
            }
        }

        /* New styles for text input and confirm button */
        #confirmation-section {
            display: none;
            margin-top: 20px;
        }

        #confirmation-section input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        #confirmation-section button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #confirmation-section button:hover {
            background-color: #2980b9;
        }
    </style>
</head>

<body>
    <header>
        <div style="display: flex; margin-left: 20px;">
            <div class="container" onclick="openNav(this)">
                <div class="bar1"></div>
                <div class="bar2"></div>
                <div class="bar3"></div>
            </div>
            <p class="animated-text">FREELANCE GRID WRITERS</p>
            <div id="profileCircle" class="profile-circle" style=" width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #91af4c; /* You can customize this color */
            color: rgb(168, 23, 23);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
            text-transform: uppercase;
            
            margin-right: 5%;
            padding: 7px;
            border-color: rgb(168, 23, 23);
            border-style: solid;

        
          
        ">
            </div>
        </div>
    </header>
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <p style="margin-left: 20px;"> <i class="fa-solid fa-landmark"></i> NAVIGATION</p>
        <a href="dashboard.html"> <i class="fa-solid fa-house"></i> Dashboard</a>
        <a href="Manualact.html"><i class="fa-solid fa-chart-line"></i> Account Activation</a>
        <a href="availjobs.html"> <i class="fa-solid fa-list-check"></i> Available Jobs</a>
        <a href="virtualtr.html"> <i class="fa-solid fa-cloud"></i> Virtual training</a>
        <a href="awardedjobs.html"> <i class="fa-solid fa-award"></i> Awarded jobs</a>
        <a href="submitjbs.html"> <i class="fa-solid fa-check"></i> Submit jobs</a>
        <a href="cashout.html"> <i class="fa-solid fa-wallet"></i> Cashout</a>
        <a href="myprof.html"><i class="fa-solid fa-user"></i> My profile</a>
        <a href="#" onclick="logout()"> <i class="fa-solid fa-power-off"></i> Logout</a>
    </div>
    <div>
        <p
            style="color: rgb(5, 5, 5); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: bolder; align-items: center; margin-left: 30px; margin-top: 20px; margin-bottom: 20px;">
            VIRTUAL TRAINING</p>

        <div id="activationMessage">
            <p>You have not yet activated your account. Please activate to book for training.</p>
            <button id="activateNow" onclick="activateow()">Activate Now</button>
            <div class="progressBar" id="progressBar">
                <div></div>
            </div>
        </div>

        <div id="activationMessage1" style="display: none;">
            <p>You have not yet completed your training. Please complete training to work with us.</p>

            <div class="progressBar" id="progressBar1">
                <div></div>
            </div>
        </div>
        <div id="trainingImportance"
            style=" background-color: rgba(255, 99, 71, 0.1); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); margin: 20px auto; width: 80%; text-align: center;">
            <h2 style="color: #d14e2e; font-size: 24px; font-weight: bold;">Why Training Is Important Before Using Our
                Site</h2>
            <p style="color: #333; font-size: 16px; margin: 20px 0; line-height: 1.6;">
                Before using our platform, it’s crucial to go through our training to ensure a smooth and successful
                experience.
                <br><br>
                Our training sessions are designed to provide you with the necessary skills to navigate our site, make
                informed decisions, and maximize the tools available to you. By completing the training, you will:
            </p>
            <ul style="color: #555; font-size: 16px; text-align: left; margin-left: 20px;">
                <li>Learn how to use all features effectively</li>
                <li>Understand how to manage tasks and interact with other users</li>
                <li>Ensure a safer experience by understanding the security protocols</li>
                <li>Gain confidence in your ability to use the site to its full potential</li>
            </ul>
            <p style="color: #333; font-size: 16px; margin-top: 20px;">
                We believe that well-trained users are the key to a positive and successful platform experience. So, we
                highly encourage you to complete the training before you begin.
            </p>

            <button class="activateNow"
                style="background-color: #d14e2e; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Start Training Now
            </button>
            <div id="loading1" class="loading"></div>
        </div>
        <div id="trainingConfirmation"
            style="background-color: rgba(102, 205, 170, 0.1); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); margin: 20px auto; width: 80%; text-align: center; display: none;">
            <h2 style="color: #4caf50; font-size: 24px; font-weight: bold;">Your Payment Has Been Received!</h2>
            <p style="color: #333; font-size: 16px; margin: 20px 0; line-height: 1.6;"> We’ve successfully received your
                payment! We are now in the process of scheduling your training session, which will take place within the
                next 48 hours. <br><br> The training will help you get the most out of our platform, ensuring you have
                all the tools and knowledge necessary for a seamless experience. During the session, you’ll: </p>
            <ul style="color: #555; font-size: 16px; text-align: left; margin-left: 20px;">
                <li>Learn how to navigate the platform with ease</li>
                <li>Master key features to streamline your tasks</li>
                <li>Understand security protocols to keep your account safe</li>
                <li>Boost your confidence in using all available tools</li>
            </ul>
            <p style="color: #333; font-size: 16px; margin-top: 20px;"></p>

        </div>
        <!-- Popup Modal -->
        <div class="popup" id="popupModal">
            <div class="popupContent">
                <h2>You have not yet activated your account. Please activate to work with us.</h2>
                <button onclick="activateow()">Activate Now</button>
                <button onclick="closePopup()">Cancel</button> <!-- Cancel button -->
                <div class="progressBar" id="progressBar1">
                    <div></div>
                </div>
            </div>
        </div>

        <div>
            <p id="note"
                style="background-color: rgba(255, 99, 71, 0.1); padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); margin: 20px auto; width: 80%; text-align: center; display: none;">
                NOTE: To access our training sessions, a payment of Kes : 350 is required. Please complete the payment
                process to continue learning with us.".<br>
            </p>

            <button id="activateNowButton"
                style="margin-left: 30px; display: none; background-color: #d14e2e; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer; margin-top: 20px;">pay
                Now</button>
            <div id="loading2" class="loading"></div>
            <div id="pay" style="display: none;">
                <p style="margin-bottom: 20px; font-weight: bolder;">INSTRUCTIONS</p>
                <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                    ✓ Go to lipa na mpesa<br>
                    ✓ Till number 8579718 (QUICK INC SOLUTIONS)<br>
                    ✓ Amount KSH.350<br>
                    ✓ Enter M-Pesa pin to complete the transaction<br>
                    ✓ Once done, enter the mpesa number used and refresh below to activate your account instantly<br>
                </p>
                <form>
                    <input type="tel" id="phone" name="phone" placeholder="Enter phone number" required>
                    <button type="button" id="submit">Make a Payment</button>
                </form>
            </div>

            <!-- Progress Dialog (loading spinner) -->
            <div id="loading" class="loading"></div>

            <div id="confirmation-section" style="background-color: aliceblue;
    width: 90%; /* Adjust the width as needed */
    max-width: 600px; /* Optional: Add a max-width for larger screens */
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
    margin: 0 auto; /* Centers horizontally */
    display: none;
    flex-direction: column; /* Ensure content is stacked vertically */
    align-items: center; /* Centers text and other elements inside */
    justify-content: center; /* Centers content vertically */
    height: auto; /* Optional: Adjust height to take up 80% of the screen height */">
                <p>This may take a while, please paste M-Pesa message received below for faster confirmation:</p>
                <input type="text" id="mpesaMessage" placeholder="Paste your M-Pesa message here">
                <button id="confirmButton">Confirm</button>
                <div id="loading3" class="loading"></div>
            </div>
        </div>
        <footer style="background-color: black;  margin-top: 20px;">
            <p style="font-size: x-large; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">FREELANCE GRID
                WRITERS</p>
            <p
                style="margin-top: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: medium;">
                &copy; 2025 FREELANCE GRID. All Rights Reserved.</p>
            <p
                style="margin-top: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: medium;">
                Designed by Rollo Houd</p>
            <div style="display: flex; width: 100%;">
                <div style="width: 30%;">
                    <p
                        style="font-size: x-large; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin-bottom: 20px; margin-top: 20px; ">
                        Sitemap</p>
                    <a href="" style="margin-top: 15px;">Privacy Policy</a>
                </div>

                <div style="width: 30%; margin-left: 50px;">
                    <p
                        style="font-size: x-large; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin-top: 20px; margin-bottom: 20px; ">
                        Social</p>
                    <i class="fa-brands fa-facebook"></i>
                    <i class="fa-brands fa-instagram"></i>
                    <i class="fa-brands fa-x-twitter"></i>
                    <i class="fa-brands fa-whatsapp"></i>
                </div>
            </div>
        </footer>
        <script>
            function closePopup() {
                // Hide the popup when the cancel button is clicked
                document.getElementById("popupModal").style.display = "none";
            }
            function activateow() {
                window.location.href = 'Manualact.html';
            }
            /* Set the width of the side navigation to 250px and the left margin of the page content to 250px and add a black background color to body */
            function openNav() {
                document.getElementById("mySidenav").style.width = "250px";
                // document.getElementById("main").style.marginLeft = "250px";
                document.body.style.backgroundColor = "rgba(0,0,0,0.4)";
            }

            /* Set the width of the side navigation to 0 and the left margin of the page content to 0, and the background color of body to white */
            function closeNav() {
                document.getElementById("mySidenav").style.width = "0";
                document.getElementById("main").style.marginLeft = "0";
                document.body.style.backgroundColor = "white";
            }

            function showPopup() {
                document.getElementById('popupModal').style.display = 'flex';
                document.getElementById('progressBar1').style.display = 'block';
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
        <script type="module">
            // Import necessary Firebase SDK modules
            import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
            import { getDatabase, ref, get, update } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyDSzJimWxr3LlWm7etgNgsngGbBkwJzYrI",
                authDomain: "w3sfreelancewriter.firebaseapp.com",
                databaseURL: "https://w3sfreelancewriter-default-rtdb.firebaseio.com",
                projectId: "w3sfreelancewriter",
                storageBucket: "w3sfreelancewriter.appspot.com",
                messagingSenderId: "743098413859",
                appId: "1:743098413859:web:0556daeff74b515afbd296",
                measurementId: "G-DRBCQ0GXPG"
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);

            // This variable holds user status
            let stats;
            let train;

            // Ensure data is fetched after the document is ready
            document.addEventListener("DOMContentLoaded", async () => {
                const loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
                if (!loggedInUser) {
                    window.location.href = "signin.html";
                    return;
                }

                try {
                    const firstInitial = loggedInUser.firstName.charAt(0).toUpperCase();
                    const lastInitial = loggedInUser.lastName.charAt(0).toUpperCase();
                    const profileCircle = document.getElementById("profileCircle");
                    profileCircle.textContent = firstInitial + lastInitial; // Combine initials
                    const db = getDatabase();
                    const userRef = ref(db, 'users/' + loggedInUser.phone);
                    const snapshot = await get(userRef);

                    if (snapshot.exists()) {
                        stats = snapshot.val().status;
                        train = snapshot.val().train;

                        if (train === "paid") {
                            document.getElementById('trainingImportance').style.display = 'none';
                            document.getElementById('trainingConfirmation').style.display = 'block';
                        }

                        else {
                            document.getElementById('trainingImportance').style.display = 'block';

                        }
                        // Show the appropriate activation message based on user status
                        if (stats === "ACTIVE") {
                            document.getElementById('activationMessage').style.display = 'none';
                            document.getElementById('activationMessage1').style.display = 'block';

                        } else {
                            document.getElementById('activationMessage').style.display = 'block';
                            document.getElementById('activationMessage1').style.display = 'none';

                        }
                    } else {
                        console.log("User data not found in Firebase.");
                    }
                } catch (error) {
                    console.error('Error fetching user data:', error);
                }

                // Add event listeners to buttons with class 'activateNow'
                document.querySelectorAll('.activateNow').forEach(button => {
                    button.addEventListener('click', activateNow);
                });
            });

            function activateNow() {
                // Show the progress bar
                document.getElementById('loading1').style.display = 'block';


                // After 7 seconds, redirect based on user status
                setTimeout(function () {
                    document.getElementById('loading1').style.display = 'none';
                    if (stats === "ACTIVE") {
                        document.getElementById('note').style.display = 'block';
                        document.getElementById('activateNowButton').style.display = 'block';
                    } else {
                        showPopup();
                    }
                }, 7000);
            }
            document.getElementById('activateNowButton').addEventListener('click', nert);

            function nert() {
                document.getElementById("loading2").style.display = "block";
                Toastify({
                    text: "API failed! Pay manually.\n Follow instructions below.",
                    duration: 3000,
                    backgroundColor: "#ff3b30", // Red color for error
                    className: "toast-message"
                }).showToast();
                setTimeout(function () {
                    document.getElementById("loading2").style.display = "none";
                    document.getElementById('note').style.display = 'none';
                    document.getElementById('activateNowButton').style.display = 'none';
                    document.getElementById('pay').style.display = 'block';
                }, 3000);
            }

            // Function to handle "Submit" button click for phone number validation
            document.getElementById("submit").addEventListener("click", function () {
                const phoneNumber = document.getElementById("phone").value.trim();

                // Check if the phone number is valid
                if (phoneNumber.length >= 10 && !isNaN(phoneNumber)) {
                    // Show loading spinner and hide the Submit button
                    document.getElementById("loading").style.display = "block";

                    // Simulate API call with a delay of 5 seconds
                    setTimeout(function () {
                        // Hide loading spinner and show the confirmation section
                        document.getElementById("loading").style.display = "none";
                        document.getElementById("confirmation-section").style.display = "block";
                    }, 5000); // 5 seconds delay
                } else {
                    // Show error toast if phone number is invalid
                    Toastify({
                        text: "Please enter a valid phone number (at least 10 digits).",
                        duration: 3000,
                        backgroundColor: "#ff3b30", // Red color for error
                        className: "toast-message"
                    }).showToast();
                }
            });



            // Function to handle "Confirm" button click after pasting the M-Pesa message
            document.getElementById("confirmButton").addEventListener("click", async function () {
                const mpesaMessage = document.getElementById("mpesaMessage").value.trim();

                // Check if the message contains the number "550" and the name "FINEVELT"
                if (mpesaMessage.includes("350") && mpesaMessage.includes("FINEVELT")) {
                    try {
                        // Show success toast message
                        Toastify({
                            text: "M-Pesa message submitted successfully!",
                            duration: 3000,
                            backgroundColor: "#28a745", // Green color for success
                            className: "toast-message"
                        }).showToast();



                        // Assuming the loggedInUser object is available in sessionStorage and contains the user ID
                        const loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
                        const userId = loggedInUser.phone; // Ensure this is the correct field for the user ID

                        // Get a reference to the user in the database
                        const db = getDatabase();
                        const userRef = ref(db, 'users/' + userId); // Assuming users are stored under 'users/{userId}'

                        // Update the user's status to "ACTIVE"
                        await update(userRef, {
                            train: 'paid'
                        });

                        console.log("User status updated to ACTIVE");
                        document.getElementById("loading3").style.display = "block";
                        setTimeout(function () {
                            // Hide loading spinner and show the confirmation section
                            document.getElementById("loading3").style.display = "none";
                            window.location.href = 'dashboard.html'

                            // You could also update the UI to reflect this change
                            // For example, change the status text on the page or notify the user that the account is now active.
                        }, 4000);


                    } catch (error) {
                        console.error('Error updating user status:', error);

                        // Show error toast if there was an issue updating the status
                        Toastify({
                            text: "Check your internet and try again.",
                            duration: 3000,
                            backgroundColor: "#ff3b30", // Red color for error
                            className: "toast-message"
                        }).showToast();
                    }

                } else {
                    // Show error toast if message format is incorrect
                    Toastify({
                        text: "Please enter the correct mpesa message received",
                        duration: 3000,
                        backgroundColor: "#ff3b30", // Red color for error
                        className: "toast-message"
                    }).showToast();
                }
            });

            function logout() {
                // Clear session storage
                sessionStorage.clear();

                // Redirect to sign-in page
                window.location.href = "signin.html";
            }



        </script>
</body>

</html>